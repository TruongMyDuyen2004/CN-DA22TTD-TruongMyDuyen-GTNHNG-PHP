<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Form Th√™m M√≥n ƒê∆°n Gi·∫£n</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: Arial, sans-serif;
            padding: 2rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        h1 {
            color: #1f2937;
            margin-bottom: 1.5rem;
            text-align: center;
        }
        .form-group {
            margin-bottom: 1.5rem;
        }
        label {
            display: block;
            font-weight: 600;
            color: #374151;
            margin-bottom: 0.5rem;
        }
        input, select, textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1rem;
        }
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        button {
            width: 100%;
            padding: 1rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        .result {
            margin-top: 1.5rem;
            padding: 1rem;
            border-radius: 8px;
            display: none;
        }
        .result.success {
            background: #d1fae5;
            color: #065f46;
            border: 2px solid #10b981;
        }
        .result.error {
            background: #fee2e2;
            color: #991b1b;
            border: 2px solid #ef4444;
        }
        .console {
            margin-top: 1.5rem;
            padding: 1rem;
            background: #1f2937;
            color: #10b981;
            border-radius: 8px;
            font-family: monospace;
            font-size: 0.9rem;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üçΩÔ∏è Test Form Th√™m M√≥n</h1>
        
        <form id="testForm">
            <div class="form-group">
                <label>T√™n m√≥n (Ti·∫øng Vi·ªát) *</label>
                <input type="text" name="name" required value="Test m√≥n <?php echo time(); ?>">
            </div>
            
            <div class="form-group">
                <label>T√™n m√≥n (Ti·∫øng Anh)</label>
                <input type="text" name="name_en" value="Test Dish">
            </div>
            
            <div class="form-group">
                <label>Gi√° (VNƒê) *</label>
                <input type="number" name="price" required value="50000" min="0" step="1000">
            </div>
            
            <div class="form-group">
                <label>Danh m·ª•c * (ID)</label>
                <input type="number" name="category_id" required value="1" min="1">
                <small style="color: #6b7280;">Nh·∫≠p ID danh m·ª•c (th∆∞·ªùng l√† 1, 2, 3...)</small>
            </div>
            
            <div class="form-group">
                <label>M√¥ t·∫£ (Ti·∫øng Vi·ªát)</label>
                <textarea name="description" rows="2">M√¥ t·∫£ test</textarea>
            </div>
            
            <div class="form-group">
                <label>M√¥ t·∫£ (Ti·∫øng Anh)</label>
                <textarea name="description_en" rows="2">Test description</textarea>
            </div>
            
            <div class="form-group">
                <label style="display: flex; align-items: center; gap: 0.5rem;">
                    <input type="checkbox" name="is_available" value="1" checked style="width: auto;">
                    <span>M√≥n ƒÉn ƒëang c√≥ s·∫µn</span>
                </label>
            </div>
            
            <button type="submit">‚ûï Th√™m m√≥n</button>
        </form>
        
        <div id="result" class="result"></div>
        
        <div class="console" id="console">
            <strong>Console Log:</strong><br>
            <div id="log">Ch·ªù submit form...</div>
        </div>
    </div>

    <script>
        function log(message) {
            const logDiv = document.getElementById('log');
            const time = new Date().toLocaleTimeString();
            logDiv.innerHTML += `<br>[${time}] ${message}`;
            console.log(message);
        }

        document.getElementById('testForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            log('üîµ Form submitted');
            
            const formData = new FormData(this);
            const resultDiv = document.getElementById('result');
            
            // Log form data
            log('üìù Form data:');
            for (let [key, value] of formData.entries()) {
                log(`  ${key}: ${value}`);
            }
            
            resultDiv.style.display = 'block';
            resultDiv.className = 'result';
            resultDiv.innerHTML = '‚è≥ ƒêang g·ª≠i request...';
            
            try {
                log('üåê Sending request to admin/api/add-menu-item.php');
                
                const response = await fetch('admin/api/add-menu-item.php', {
                    method: 'POST',
                    body: formData
                });
                
                log(`üì° Response status: ${response.status}`);
                log(`üì° Response OK: ${response.ok}`);
                
                const contentType = response.headers.get('content-type');
                log(`üìÑ Content-Type: ${contentType}`);
                
                if (!contentType || !contentType.includes('application/json')) {
                    const text = await response.text();
                    log('‚ùå Response is not JSON!');
                    log('Response text: ' + text.substring(0, 200));
                    
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = '‚ùå L·ªói: Server kh√¥ng tr·∫£ v·ªÅ JSON<br><br>' + 
                                         '<strong>Response:</strong><br>' + 
                                         text.substring(0, 500);
                    return;
                }
                
                const data = await response.json();
                log('‚úÖ Received JSON response');
                log('Response data: ' + JSON.stringify(data, null, 2));
                
                if (data.success) {
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = '‚úÖ ' + data.message + '<br>ID m√≥n m·ªõi: ' + data.id;
                    log('‚úÖ SUCCESS!');
                    
                    // Reset form
                    setTimeout(() => {
                        location.reload();
                    }, 2000);
                } else {
                    resultDiv.className = 'result error';
                    let errorMsg = '‚ùå L·ªói: ' + data.message;
                    
                    if (data.debug) {
                        errorMsg += '<br><br><strong>Debug:</strong><br>' + JSON.stringify(data.debug, null, 2);
                    }
                    
                    resultDiv.innerHTML = errorMsg;
                    log('‚ùå ERROR: ' + data.message);
                }
                
            } catch (error) {
                log('‚ùå Catch error: ' + error.message);
                log('Error stack: ' + error.stack);
                
                resultDiv.className = 'result error';
                resultDiv.innerHTML = '‚ùå C√≥ l·ªói x·∫£y ra: ' + error.message + 
                                     '<br><br>Vui l√≤ng ki·ªÉm tra Console log ·ªü tr√™n';
            }
        });
        
        log('‚úÖ Page loaded');
    </script>
</body>
</html>
